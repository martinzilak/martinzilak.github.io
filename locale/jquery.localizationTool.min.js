!function(a){var b=!1,c={_languageCodeToOrdinal:function(b){var c=this,d=c.data("activeLanguageCodeArray"),e=a.inArray(b,d);return e===-1&&a.error("Cannot convert "+b+" into an ordinal number"),e},_ordinalToLanguageCode:function(b){var c=this,d=c.data("activeLanguageCodeArray");return(d.length<=b||b<0)&&a.error("Cannot convert "+b+" into a language code."),d[b]},_languageCodeToHtml:function(a){var b=this,d=b.data("settings"),e=d.languages,f=e[a],g="";f.flag.hasOwnProperty("class")&&(g=" "+f.flag.class);var h="";f.flag.hasOwnProperty("url")&&(h='<img src="'+f.flag.url+'" />');var i=f.language,j=f.hasOwnProperty("country"),k=[];k.push('<li class="ltool-language ',a,'">'),d.showFlag&&(k.push('<div class="ltool-language-flag',g,'"></div>'),k.push(h));var l=c._interpolateTemplate.call(b,j?f.country:void 0,i);return k.push(l),k.push("</li>"),k.join("")},_interpolateTemplate:function(a,b){var c=this,d=c.data("settings"),e=d.labelTemplate,f="",g="",h="string"==typeof a;if(d.showCountry&&h&&(f=['<span class="ltool-language-country">',"$1"+a.replace(/[$]/g,"&#36;")+"$2","</span>"].join("")),d.showLanguage){var i=h?"ltool-has-country ":"";g=['<span class="',i,'ltool-language-name">',"$1"+b.replace(/[$]/g,"&#36;")+"$2","</span>"].join("")}return'<span class="ltool-language-countryname">'+e.replace(/{{([^{]*)language([^}]*)}}/g,g).replace(/{{([^{]*)country([^}]*)}}/g,f)+"</span>"},_selectLanguage:function(b){var c=this;c.find(".ltool-dropdown-label").html(a(".ltool-language."+b).html()),c.data("selectedLanguageCode",b)},_initializeWidget:function(b){var d=this,e=d.data("settings"),f=e.languages,g=[];g.push('<span tabindex="0" class="ltool-dropdown-label">Change Language</span><div class="ltool-dropdown-label-arrow"></div>'),g.push('<ul class="ltool-dropdown-items">');var h,i;for(i=0;h=b[i++];)f.hasOwnProperty(h)?g.push(c._languageCodeToHtml.call(d,h)):a.error("The language '"+h+"' must be defined");return g.push("</ul>"),a(g.join("")).appendTo(d),d},_onDropdownClicked:function(){var a=this,b=a.data("selectedLanguageCode");return a.find(".ltool-language").removeClass("ltool-is-selected"),a.find("."+b).addClass("ltool-is-selected"),a.toggleClass("ltool-is-visible"),a},_closeDropdown:function(){var a=this;a.removeClass("ltool-is-visible")},_onMouseout:function(a){var b=this;return b.find(a.relatedTarget).length>0?(b.find(".ltool-is-selected").removeClass("ltool-is-selected"),a.preventDefault(),b):void b.removeClass("ltool-is-visible")},_onLanguageSelected:function(a){var b=this,d=a.attr("class").replace("ltool-language","").replace("ltool-is-selected","").replace(/ /g,"");c._selectLanguage.call(b,d),c._mayTranslate.call(b,d)},_selectPreviousLanguage:function(){var a=this,b=a.data("selectedLanguageCode"),d=c._languageCodeToOrdinal.call(a,b);if(0!==d){var e=c._ordinalToLanguageCode.call(a,d-1);return a.find(".ltool-is-selected").removeClass("ltool-is-selected"),c._selectLanguage.call(a,e),c._mayTranslate.call(a,e),a.find("."+e).addClass("ltool-is-selected"),a}},_selectNextLanguage:function(){var a=this,b=a.data("activeLanguageCodeArray"),d=a.data("selectedLanguageCode"),e=c._languageCodeToOrdinal.call(a,d);if(!(e+1>=b.length)){var f=c._ordinalToLanguageCode.call(a,e+1);return a.find(".ltool-is-selected").removeClass("ltool-is-selected"),c._selectLanguage.call(a,f),c._mayTranslate.call(a,f),a.find("."+f).addClass("ltool-is-selected"),a}},_onKeydown:function(a){var b=this;switch(a.keyCode){case 13:c._onDropdownClicked.call(b),a.preventDefault();break;case 40:c._selectNextLanguage.call(b),a.preventDefault();break;case 38:c._selectPreviousLanguage.call(b),a.preventDefault();break;case 27:c._closeDropdown.call(b),a.preventDefault()}return b},_bindEvents:function(){var d=this;return d.bind("mousedown.localizationTool",function(a){b=!1,c._onKeydown.call(d,a)}).bind("click.localizationTool",function(a){c._onDropdownClicked.call(d,a)}).bind("keydown.localizationTool",function(a){b=!0,c._onKeydown.call(d,a)}).bind("mouseout.localizationTool",function(a){c._onMouseout.call(d,a)}).bind("focusout.localizationTool",function(){b&&c._closeDropdown.call(d)}),d.find(".ltool-language").bind("click.localizationTool",function(){c._onLanguageSelected.call(d,a(this))}),d},_decomposeStringsForReferenceMapping:function(){var e,a={idStrings:[],classStrings:[],elementStrings:[],textStrings:[],attributeStrings:[]},b=this,c=b.data("settings").strings,d=new RegExp("^[a-zA-Z-]+?::");for(e in c)c.hasOwnProperty(e)&&(e.match(d)?a.attributeStrings.push(e):0===e.indexOf("id:")?a.idStrings.push(e):0===e.indexOf("class:")?a.classStrings.push(e):0===e.indexOf("element:")?a.elementStrings.push(e):a.textStrings.push(e));return a},_buildStringReferenceMapping:function(){var h,i,b=this,d={},e=b.data("settings"),f=e.strings,g=c._decomposeStringsForReferenceMapping.call(b);for(i=0;h=g.idStrings[i++];){var j=h.substring("id:".length),k=a("#"+j),l=k.contents();e.ignoreUnmatchedSelectors===!0&&0===l.length||(1!==l.length?a.error(h+" must contain exactly one text node, found "+l.length+" instead"):3!==l[0].nodeType?a.error(h+" does not contain a #text node (i.e., type 3)"):d[h]={isAttribute:!1,originalText:k.text(),domNodes:[k]})}var m=function(b,c,e,h){var j,k=b.replace(":","");for(i=0;j=g[k+"Strings"][i++];){var m,l=j.substring(b.length),n=[],o=!0;m=void 0;var q,p=0;a:for(;q=a(c+l)[p++];){var r=a(q);if(e){var s=r.attr("id");if("string"==typeof s&&f.hasOwnProperty("id:"+s))continue a}if(h){var t=r.attr("class");if("string"==typeof t)for(var v,u=t.split(" "),w=0;v=u[w++];)if("string"==typeof v&&f.hasOwnProperty("class:"+v))continue a}var x=r.contents();0===x.length||x.length>1?a.error("A '"+j+"' node was found to contain "+x.length+" child nodes. This node must contain exactly one text node!"):3===x[0].nodeType?(n.push(r),"undefined"==typeof m?m=r.text():m!==r.text()&&(o=!1)):a.error("A '"+j+"' node does not contain a #text node (i.e., type 3)")}o?d[j]={isAttribute:!1,originalText:m,domNodes:n}:a.error("Not all text content of elements with "+j+" were found to be '"+m+"'. So these elements will be ignored.")}};m("class:",".",!0,!1),m("element:","",!0,!0);var o,n=new RegExp("(class|id|element):[^:]");for(i=0;o=g.attributeStrings[i++];){var p=o.split("::"),q=p.shift();0===p.length&&a.error("sorry, you need to specify class:, element: or id: selectors in "+o);var r=p.join("::");p[0].match(n)||a.error(o+"Doesn't look right. Perhaps you've added extra semicolons?"),r=r.replace("id:","#"),r=r.replace("class:","."),r=r.replace("element:","");var s=a(r+"["+q+"]");0===s.length&&a.error('The selector "'+o+'" does not point to an existing DOM element');var t=0,u=!0,v=a(s[0]).attr(q),w=[];for(t=0;t<s.length;t++){var x=a(s[t]);v!==x.attr(q)&&(u=!1),w.push(x)}u||a.error("Not all the attribute values selected via "+o+" are the same"),d[o]={isAttribute:!0,originalText:v,domNodes:w}}var y;for(i=0;y=g.textStrings[i++];){var B,C,z=[],A=a(":contains("+y+")");for(B=0;C=A[B++];){var D=a(C).contents();1===D.length&&3===D[0].nodeType&&z.push(a(C))}z.length>0&&(d[y]={isAttribute:!1,originalText:y,domNodes:z})}return b.data("refMappingObj",d),b},_mayTranslate:function(a){var b=this,d=b.data("settings");!1!==d.onLanguageSelected(a)&&c._translate.call(b,a)},getSelectedLanguageCode:function(){var a=this;return a.data("selectedLanguageCode")},_translate:function(b){var c=this,d=c.data("settings"),e=d.strings,f=c.data("refMappingObj"),g="ltr";if("undefined"!=typeof b){if(!d.languages.hasOwnProperty(b))return a.error("The language code "+b+" is not defined"),c;d.languages[b].hasOwnProperty("cssDirection")&&(g=d.languages[b].cssDirection)}var h;for(h in f)if(f.hasOwnProperty(h)){var i;i="undefined"==typeof b||b===d.defaultLanguage?f[h].originalText:e[h][b];var k,l,j=f[h].domNodes;if(f[h].isAttribute===!0){var m=h.split("::",1)[0];for(l=0;k=j[l++];)k.attr(m,i),k.css("direction",g)}else for(l=0;k=j[l++];)k.html(i),k.css("direction",g)}return c},translate:function(a){var b=this;return c._translate.call(b,a),c._selectLanguage.call(b,a),b},destroy:function(){var b=this;return b.removeData(),b.unbind("click.localizationTool",function(a){c._onDropdownClicked.call(b,a)}),b.find(".ltool-language").unbind("click.localizationTool",function(){c._onLanguageSelected.call(b,a(this))}),b.unbind("mouseout.localizationTool",function(a){c._onMouseout.call(b,a)}),b.empty(),b},_sortCountryLanguagesByCountryName:function(a,b){return b.sort(function(b,c){return a[b].hasOwnProperty("country")&&a[c].hasOwnProperty("country")?a[b].country.localeCompare(a[c].country):a[b].hasOwnProperty("country")?a[b].country.localeCompare(a[c].language):a[b].language.localeCompare(a[c].country)})},_findSubsetOfUsedLanguages:function(b){var e,d=this,f=d.data("settings"),g={},h=0;for(e in b)if(b.hasOwnProperty(e)){var j,i=b[e];for(j in i)i.hasOwnProperty(j)&&(g.hasOwnProperty(j)||(g[j]=0)),g[j]++;h++}var l,k=[];for(l in g)g.hasOwnProperty(l)&&g[l]===h&&k.push(l);var m=a.inArray(f.defaultLanguage,k);return m>-1&&k.splice(m,1),k.unshift(f.defaultLanguage),c._sortCountryLanguagesByCountryName.call(this,f.languages,k)},init:function(b){var d={en_US:{country:"United States of America",language:"English",countryTranslated:"United States of America",languageTranslated:"English",flag:{class:"flag flag-us"}},sk_SK:{country:"Slovakia",language:"Slovak",countryTranslated:"Slovensko",languageTranslated:"Slovenčina",flag:{class:"flag flag-sk"}},cs_CZ:{country:"Czech Republic",language:"Czech",countryTranslated:"Česko",languageTranslated:"Čeština",flag:{class:"flag flag-cz"}}},e=a.extend({defaultLanguage:"en_US",ignoreUnmatchedSelectors:!1,showFlag:!0,showLanguage:!0,showCountry:!0,labelTemplate:"{{country}} {{(language)}}",languages:{},strings:{},onLanguageSelected:function(){return!0}},b);return e.languages=a.extend(d,e.languages),e.languages.hasOwnProperty(e.defaultLanguage)||a.error("FATAL: the default language "+e.defaultLanguage+" is not defined in the 'languages' parameter!"),this.each(function(){var b=a(this);b.data("settings",e);var d=c._findSubsetOfUsedLanguages.call(b,e.strings);b.data("activeLanguageCodeArray",d),c._initializeWidget.call(b,d),c._selectLanguage.call(b,e.defaultLanguage),c._bindEvents.call(b),c._buildStringReferenceMapping.call(b)})}},d="localizationTool";a.fn[d]=function(b){if(c[b]){if(this.data("initialized")===!0)return c[b].apply(this,Array.prototype.slice.call(arguments,1));throw new Error("method "+b+" called on an uninitialized instance of "+d)}return"object"!=typeof b&&b?void a.error("Cannot call method "+b):(this.data("initialized",!0),c.init.apply(this,arguments))}}(jQuery);